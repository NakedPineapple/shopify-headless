{#
    Payment Section Partial

    Variables:
    - order: OrderDetailView with pricing, transactions
#}

<div class="bg-card rounded-xl border border-border">
    <div class="px-6 py-4 border-b border-border flex items-center justify-between">
        <h3 class="text-lg font-semibold text-foreground">
            <i class="ph ph-credit-card mr-2"></i>Payment
        </h3>
        <button type="button"
                onclick="document.getElementById('refund-modal').classList.remove('hidden')"
                class="text-sm text-primary hover:underline">
            <i class="ph ph-arrow-counter-clockwise mr-1"></i>Refund
        </button>
    </div>

    <!-- Order Summary -->
    <div class="px-6 py-4 space-y-2 text-sm">
        <div class="flex justify-between">
            <span class="text-muted-foreground">Subtotal</span>
            <span class="text-foreground">{{ order.subtotal }}</span>
        </div>
        <div class="flex justify-between">
            <span class="text-muted-foreground">Shipping</span>
            <span class="text-foreground">{{ order.shipping }}</span>
        </div>
        {% if order.discount != "$0.00" %}
        <div class="flex justify-between">
            <span class="text-muted-foreground">Discount</span>
            <span class="text-success">-{{ order.discount }}</span>
        </div>
        {% endif %}
        <div class="flex justify-between">
            <span class="text-muted-foreground">Tax</span>
            <span class="text-foreground">{{ order.tax }}</span>
        </div>
        <div class="flex justify-between pt-2 border-t border-border font-semibold">
            <span class="text-foreground">Total</span>
            <span class="text-foreground">{{ order.total }}</span>
        </div>
    </div>

    <!-- Payment Status -->
    <div class="px-6 py-4 border-t border-border bg-muted/50 space-y-2 text-sm">
        <div class="flex justify-between">
            <span class="text-muted-foreground">Paid</span>
            <span class="text-foreground">{{ order.total_paid }}</span>
        </div>
        {% if order.total_refunded != "$0.00" %}
        <div class="flex justify-between">
            <span class="text-muted-foreground">Refunded</span>
            <span class="text-destructive">-{{ order.total_refunded }}</span>
        </div>
        <div class="flex justify-between font-medium">
            <span class="text-foreground">Net payment</span>
            <span class="text-foreground">{{ order.net_payment }}</span>
        </div>
        {% endif %}
        {% if order.total_outstanding != "$0.00" %}
        <div class="flex justify-between pt-2 border-t border-border">
            <span class="text-warning font-medium">Outstanding</span>
            <span class="text-warning font-medium">{{ order.total_outstanding }}</span>
        </div>
        {% endif %}
    </div>

    <!-- Transaction History -->
    {% if !order.transactions.is_empty() %}
    <div class="px-6 py-4 border-t border-border">
        <p class="text-sm font-medium text-foreground mb-3">Transaction history</p>
        <div class="space-y-3">
            {% for txn in order.transactions %}
            <div class="flex items-center justify-between text-sm">
                <div class="flex items-center gap-2">
                    <i class="ph {% if txn.kind == "SALE" || txn.kind == "CAPTURE" %}ph-arrow-down text-success{% elif txn.kind == "REFUND" %}ph-arrow-up text-destructive{% else %}ph-clock text-muted-foreground{% endif %}"></i>
                    <div>
                        <span class="text-foreground">{{ txn.kind }}</span>
                        {% if let Some(gateway) = txn.gateway %}
                        <span class="text-muted-foreground">via {{ gateway }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="text-right">
                    <span class="{% if txn.kind == "REFUND" %}text-destructive{% else %}text-foreground{% endif %}">
                        {% if txn.kind == "REFUND" %}-{% endif %}{{ txn.amount }}
                    </span>
                    <span class="badge badge-{% if txn.status == "SUCCESS" %}success{% elif txn.status == "PENDING" %}warning{% else %}destructive{% endif %} ml-2">
                        {{ txn.status }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
