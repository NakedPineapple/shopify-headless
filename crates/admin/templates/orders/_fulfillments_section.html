{#
    Existing Fulfillments Section Partial

    Variables:
    - order: OrderDetailView with fulfillments
#}

{% if !order.fulfillments.is_empty() %}
<div class="bg-card rounded-xl border border-border">
    <div class="px-6 py-4 border-b border-border">
        <h3 class="text-lg font-semibold text-foreground">
            <i class="ph ph-check-circle mr-2 text-success"></i>Fulfilled
        </h3>
    </div>
    <div class="divide-y divide-border">
        {% for fulfillment in order.fulfillments %}
        <div class="px-6 py-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <span class="badge badge-success">{{ fulfillment.status }}</span>
                    <span class="text-sm text-muted-foreground">{{ fulfillment.created_at }}</span>
                </div>
                {% if let Some(location) = fulfillment.location_name %}
                <span class="text-sm text-muted-foreground">
                    <i class="ph ph-map-pin mr-1"></i>{{ location }}
                </span>
                {% endif %}
            </div>

            <!-- Tracking Info -->
            {% if let Some(tracking) = fulfillment.tracking_number %}
            <div class="mb-3 p-3 bg-muted rounded-lg">
                <div class="flex items-center gap-2 text-sm">
                    <i class="ph ph-truck text-muted-foreground"></i>
                    {% if let Some(carrier) = fulfillment.carrier %}
                    <span class="text-muted-foreground">{{ carrier }}:</span>
                    {% endif %}
                    {% if let Some(url) = fulfillment.tracking_url %}
                    <a href="{{ url }}" target="_blank" rel="noopener" class="text-primary hover:underline">
                        {{ tracking }} <i class="ph ph-arrow-square-out text-xs"></i>
                    </a>
                    {% else %}
                    <span class="text-foreground font-medium">{{ tracking }}</span>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Fulfilled Items Summary -->
            {% if !fulfillment.line_items.is_empty() %}
            <div class="text-sm text-muted-foreground">
                {{ fulfillment.line_items.len() }} item{% if fulfillment.line_items.len() != 1 %}s{% endif %} fulfilled
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
