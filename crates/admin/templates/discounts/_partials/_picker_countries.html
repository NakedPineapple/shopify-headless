{# Country multi-select picker for free shipping discounts #}
{# Used for selecting shipping destination countries #}
<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50" id="country-picker-overlay">
    <div class="bg-card rounded-xl border border-border shadow-xl w-full max-w-lg max-h-[80vh] flex flex-col">
        {# Header #}
        <div class="flex items-center justify-between p-4 border-b border-border">
            <h3 class="text-lg font-semibold text-foreground">Select Countries</h3>
            <button type="button"
                    onclick="document.getElementById('country-picker-overlay').remove()"
                    class="p-1 text-muted-foreground hover:text-foreground transition-colors">
                <i class="ph ph-x text-xl"></i>
            </button>
        </div>

        {# Search #}
        <div class="p-4 border-b border-border">
            <div class="relative">
                <i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"></i>
                <input type="search"
                       id="country-search"
                       placeholder="Search countries..."
                       oninput="filterCountries(this.value)"
                       class="w-full pl-10 pr-4 py-2 bg-input border border-border rounded-lg text-foreground focus:ring-2 focus:ring-ring focus:border-ring">
            </div>
        </div>

        {# Country List #}
        <div class="flex-1 overflow-y-auto" id="country-list">
            {# Common countries at top #}
            <div class="p-2 border-b border-border">
                <p class="px-2 py-1 text-xs font-medium text-muted-foreground uppercase">Common</p>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="US">
                    <input type="checkbox" value="US" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">United States</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="CA">
                    <input type="checkbox" value="CA" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Canada</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="GB">
                    <input type="checkbox" value="GB" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">United Kingdom</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="AU">
                    <input type="checkbox" value="AU" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Australia</span>
                </label>
            </div>

            {# All countries #}
            <div class="p-2">
                <p class="px-2 py-1 text-xs font-medium text-muted-foreground uppercase">All Countries</p>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="AF">
                    <input type="checkbox" value="AF" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Afghanistan</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="AL">
                    <input type="checkbox" value="AL" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Albania</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="DZ">
                    <input type="checkbox" value="DZ" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Algeria</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="AR">
                    <input type="checkbox" value="AR" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Argentina</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="AT">
                    <input type="checkbox" value="AT" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Austria</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="BE">
                    <input type="checkbox" value="BE" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Belgium</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="BR">
                    <input type="checkbox" value="BR" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Brazil</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="CN">
                    <input type="checkbox" value="CN" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">China</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="DE">
                    <input type="checkbox" value="DE" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Germany</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="FR">
                    <input type="checkbox" value="FR" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">France</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="IN">
                    <input type="checkbox" value="IN" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">India</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="IT">
                    <input type="checkbox" value="IT" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Italy</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="JP">
                    <input type="checkbox" value="JP" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Japan</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="MX">
                    <input type="checkbox" value="MX" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Mexico</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="NL">
                    <input type="checkbox" value="NL" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Netherlands</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="NZ">
                    <input type="checkbox" value="NZ" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">New Zealand</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="ES">
                    <input type="checkbox" value="ES" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Spain</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="SE">
                    <input type="checkbox" value="SE" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Sweden</span>
                </label>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer" data-country="CH">
                    <input type="checkbox" value="CH" class="text-primary focus:ring-primary rounded country-checkbox">
                    <span class="text-foreground">Switzerland</span>
                </label>
            </div>
        </div>

        {# Selected count #}
        <div class="p-4 border-t border-border bg-muted/50">
            <span class="text-sm text-muted-foreground">
                <span id="selected-country-count">0</span> countries selected
            </span>
        </div>

        {# Footer #}
        <div class="flex items-center justify-end gap-3 p-4 border-t border-border">
            <button type="button"
                    onclick="document.getElementById('country-picker-overlay').remove()"
                    class="px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/90 transition-colors">
                Cancel
            </button>
            <button type="button"
                    onclick="confirmCountrySelection()"
                    class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors">
                Apply
            </button>
        </div>
    </div>
</div>

<script>
function filterCountries(query) {
    const labels = document.querySelectorAll('[data-country]');
    const lowerQuery = query.toLowerCase();
    labels.forEach(label => {
        const text = label.querySelector('span').textContent.toLowerCase();
        label.style.display = text.includes(lowerQuery) ? '' : 'none';
    });
}

function updateCountryCount() {
    const count = document.querySelectorAll('.country-checkbox:checked').length;
    document.getElementById('selected-country-count').textContent = count;
}

document.querySelectorAll('.country-checkbox').forEach(cb => {
    cb.addEventListener('change', updateCountryCount);
});

function confirmCountrySelection() {
    const selected = Array.from(document.querySelectorAll('.country-checkbox:checked'))
        .map(cb => cb.value);
    const input = document.querySelector('input[name="country_codes"]');
    if (input) input.value = selected.join(',');
    document.getElementById('country-picker-overlay').remove();
}
</script>
