{% extends "layouts/base.html" %}

{% block title %}Manufacturing Batches{% endblock %}

{% block page_title %}
<div class="flex items-center justify-between">
    <div>
        <h1 class="text-2xl font-semibold text-foreground">Manufacturing Batches</h1>
        <p class="text-sm text-muted-foreground mt-1">Track production runs and costs</p>
    </div>
    <a href="/financials/manufacturing/new"
       class="inline-flex items-center gap-2 px-4 py-2 bg-coral text-white rounded-lg hover:bg-coral/90 transition-colors">
        <i class="ph ph-plus"></i>
        New Batch
    </a>
</div>
{% endblock %}

{% block content %}
<!-- Tab Navigation -->
<div class="mb-6 border-b border-border">
    <nav class="flex gap-6">
        <a href="/financials/manufacturing" class="text-foreground py-3 border-b-2 border-coral">
            Manufacturing
        </a>
    </nav>
</div>

<!-- Batches Table -->
<div class="bg-card rounded-xl border border-border overflow-hidden">
    {% if batches.is_empty() %}
    <div class="p-12 text-center">
        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-muted flex items-center justify-center">
            <i class="ph ph-factory text-2xl text-muted-foreground"></i>
        </div>
        <h3 class="text-lg font-medium text-foreground mb-2">No batches yet</h3>
        <p class="text-sm text-muted-foreground mb-4">Create your first manufacturing batch to start tracking costs.</p>
        <a href="/financials/manufacturing/new"
           class="inline-flex items-center gap-2 px-4 py-2 bg-coral text-white rounded-lg hover:bg-coral/90 transition-colors">
            <i class="ph ph-plus"></i>
            New Batch
        </a>
    </div>
    {% else %}
    <table class="w-full">
        <thead class="bg-muted/50 border-b border-border">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Batch #</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Product</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Manufacture Date</th>
                <th class="px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider">Quantity</th>
                <th class="px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider">Lots Received</th>
                <th class="px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider">Cost/Unit</th>
                <th class="px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider">Total Cost</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-border">
            {% for batch in batches %}
            <tr class="hover:bg-muted/30 transition-colors cursor-pointer" onclick="window.location='/financials/manufacturing/{{ batch.id }}'">
                <td class="px-6 py-4">
                    <a href="/financials/manufacturing/{{ batch.id }}" class="text-sm font-medium text-coral hover:underline">{{ batch.batch_number }}</a>
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                        {% if let Some(image_url) = batch.product_image %}
                        <img src="{{ image_url }}" alt="" class="w-8 h-8 rounded object-cover bg-muted">
                        {% else %}
                        <div class="w-8 h-8 rounded bg-muted flex items-center justify-center">
                            <i class="ph ph-package text-sm text-muted-foreground"></i>
                        </div>
                        {% endif %}
                        <div class="min-w-0">
                            {% if let Some(title) = batch.product_title %}
                            <p class="text-sm text-foreground truncate max-w-[200px]">{{ title }}</p>
                            {% else %}
                            <p class="text-sm text-muted-foreground font-mono">#{{ batch.product_short_id }}</p>
                            {% endif %}
                            {% if let Some(variant) = batch.variant_title %}
                            <p class="text-xs text-muted-foreground truncate max-w-[200px]">{{ variant }}</p>
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 text-sm text-muted-foreground">{{ batch.manufacture_date }}</td>
                <td class="px-6 py-4 text-sm text-foreground text-right">{{ batch.quantity }}</td>
                <td class="px-6 py-4 text-sm text-right">
                    {% if batch.lots_received > 0 %}
                    <span class="text-green-500">{{ batch.lots_received }}</span>
                    {% else %}
                    <span class="text-muted-foreground">0</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 text-sm text-foreground text-right">${{ batch.cost_per_unit }} {{ batch.currency_code }}</td>
                <td class="px-6 py-4 text-sm font-medium text-foreground text-right">${{ batch.total_batch_cost }} {{ batch.currency_code }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination -->
    {% if has_prev || has_next %}
    <div class="px-6 py-4 border-t border-border flex items-center justify-between">
        <p class="text-sm text-muted-foreground">{{ total_count }} batches total</p>
        <div class="flex gap-2">
            {% if has_prev %}
            <a href="/financials/manufacturing?page={{ page - 1 }}" class="px-3 py-1 text-sm bg-muted rounded hover:bg-accent transition-colors">Previous</a>
            {% endif %}
            {% if has_next %}
            <a href="/financials/manufacturing?page={{ page + 1 }}" class="px-3 py-1 text-sm bg-muted rounded hover:bg-accent transition-colors">Next</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
    {% endif %}
</div>
{% endblock %}
