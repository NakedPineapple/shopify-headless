{% extends "layouts/base.html" %}

{% block title %}Dispute #{{ dispute.dispute.short_id }}{% endblock %}

{% block page_title %}Dispute #{{ dispute.dispute.short_id }}{% endblock %}

{% block page_subtitle %}
<div class="flex items-center gap-3 mt-1">
    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ dispute.dispute.status_class }}">
        {% if dispute.dispute.is_urgent %}
        <span class="w-1.5 h-1.5 bg-red-500 rounded-full mr-1.5"></span>
        {% endif %}
        {{ dispute.dispute.status }}
    </span>
    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ dispute.dispute.type_class }}">
        {{ dispute.dispute.dispute_type }}
    </span>
</div>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Back Link -->
    <a href="/payouts/disputes" class="inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground">
        <i class="ph ph-arrow-left"></i>
        Back to Disputes
    </a>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Dispute Details Card -->
            <div class="bg-card rounded-xl border border-border p-6">
                <h2 class="text-lg font-semibold text-foreground mb-4">Dispute Details</h2>
                <dl class="grid grid-cols-2 gap-4">
                    <div>
                        <dt class="text-sm text-muted-foreground">Amount</dt>
                        <dd class="text-lg font-semibold text-foreground">{{ dispute.dispute.amount }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-muted-foreground">Initiated</dt>
                        <dd class="text-sm text-foreground">{{ dispute.dispute.initiated_at }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-muted-foreground">Reason</dt>
                        <dd class="text-sm text-foreground">{{ dispute.dispute.reason }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-muted-foreground">Evidence Due</dt>
                        <dd class="text-sm {% if dispute.dispute.is_urgent %}text-red-600 dark:text-red-400 font-medium{% else %}text-foreground{% endif %}">
                            {% if let Some(due) = dispute.dispute.evidence_due_by %}
                                {{ due }}
                            {% else %}
                                <span class="text-muted-foreground">â€”</span>
                            {% endif %}
                        </dd>
                    </div>
                </dl>
            </div>

            <!-- Evidence Status Card -->
            <div class="bg-card rounded-xl border border-border p-6">
                <h2 class="text-lg font-semibold text-foreground mb-4">Evidence Status</h2>
                {% if dispute.evidence_submitted %}
                <div class="flex items-center gap-3 text-green-600 dark:text-green-400">
                    <i class="ph ph-check-circle text-2xl"></i>
                    <div>
                        <p class="font-medium">Evidence Submitted</p>
                        {% if let Some(sent) = dispute.evidence_sent_on %}
                        <p class="text-sm text-muted-foreground">Sent on {{ sent }}</p>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="flex items-center gap-3 text-yellow-600 dark:text-yellow-400">
                    <i class="ph ph-warning text-2xl"></i>
                    <div>
                        <p class="font-medium">Evidence Not Submitted</p>
                        <p class="text-sm text-muted-foreground">Submit evidence before the deadline to respond to this dispute.</p>
                    </div>
                </div>
                {% endif %}

                {% if let Some(desc) = dispute.product_description %}
                <div class="mt-4 pt-4 border-t border-border">
                    <dt class="text-sm text-muted-foreground mb-2">Product Description</dt>
                    <dd class="text-sm text-foreground">{{ desc }}</dd>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Order Info Card -->
            <div class="bg-card rounded-xl border border-border p-6">
                <h3 class="text-sm font-medium text-muted-foreground mb-4">Order Information</h3>
                {% if let Some(name) = dispute.dispute.order_name %}
                <div class="space-y-3">
                    <div>
                        <a href="/orders/{{ dispute.dispute.order_id.as_deref().unwrap_or("") }}" class="text-primary hover:underline font-medium">
                            {{ name }}
                        </a>
                    </div>
                    {% if let Some(total) = dispute.order_total %}
                    <div>
                        <dt class="text-xs text-muted-foreground">Order Total</dt>
                        <dd class="text-sm text-foreground">{{ total }}</dd>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <p class="text-sm text-muted-foreground">No order linked</p>
                {% endif %}
            </div>

            <!-- Customer Info Card -->
            <div class="bg-card rounded-xl border border-border p-6">
                <h3 class="text-sm font-medium text-muted-foreground mb-4">Customer Information</h3>
                <div class="space-y-2">
                    {% if let Some(name) = dispute.customer_name %}
                    <p class="text-sm text-foreground">{{ name }}</p>
                    {% endif %}
                    {% if let Some(email) = dispute.customer_email %}
                    <p class="text-sm text-muted-foreground">{{ email }}</p>
                    {% endif %}
                    {% if dispute.customer_name.is_none() && dispute.customer_email.is_none() %}
                    <p class="text-sm text-muted-foreground">No customer information available</p>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>

    <!-- Evidence Submission Form -->
    {% if !dispute.evidence_submitted %}
    <div class="bg-card rounded-xl border border-border p-6 mt-6">
        <h2 class="text-lg font-semibold text-foreground mb-4">Submit Evidence</h2>
        <p class="text-sm text-muted-foreground mb-6">
            Provide documentation to respond to this dispute. All evidence will be submitted together.
        </p>

        <form action="/payouts/disputes/{{ dispute.dispute.short_id }}" method="POST" enctype="multipart/form-data" class="space-y-6">
            <!-- Product Description -->
            <div>
                <label for="product_description" class="block text-sm font-medium text-foreground mb-2">
                    Product Description
                </label>
                <textarea
                    id="product_description"
                    name="product_description"
                    rows="4"
                    class="w-full px-4 py-3 bg-input border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:ring-2 focus:ring-ring focus:border-ring resize-none"
                    placeholder="Describe the product or service that was provided...">{{ dispute.product_description.as_deref().unwrap_or("") }}</textarea>
            </div>

            <!-- File Uploads -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Shipping Documentation -->
                <div>
                    <label class="block text-sm font-medium text-foreground mb-2">
                        Shipping Documentation
                    </label>
                    <div class="border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-primary/50 transition-colors cursor-pointer">
                        <input type="file" name="shipping_documentation" id="shipping_doc" class="hidden" accept=".pdf,.png,.jpg,.jpeg">
                        <label for="shipping_doc" class="cursor-pointer">
                            <i class="ph ph-upload text-3xl text-muted-foreground mb-2"></i>
                            <p class="text-sm text-foreground font-medium">Upload shipping proof</p>
                            <p class="text-xs text-muted-foreground mt-1">PDF, PNG, or JPG up to 10MB</p>
                        </label>
                    </div>
                </div>

                <!-- Customer Communication -->
                <div>
                    <label class="block text-sm font-medium text-foreground mb-2">
                        Customer Communication
                    </label>
                    <div class="border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-primary/50 transition-colors cursor-pointer">
                        <input type="file" name="customer_communication" id="customer_comm" class="hidden" accept=".pdf,.png,.jpg,.jpeg">
                        <label for="customer_comm" class="cursor-pointer">
                            <i class="ph ph-upload text-3xl text-muted-foreground mb-2"></i>
                            <p class="text-sm text-foreground font-medium">Upload communication</p>
                            <p class="text-xs text-muted-foreground mt-1">PDF, PNG, or JPG up to 10MB</p>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Additional Notes -->
            <div>
                <label for="uncategorized_text" class="block text-sm font-medium text-foreground mb-2">
                    Additional Information
                </label>
                <textarea
                    id="uncategorized_text"
                    name="uncategorized_text"
                    rows="3"
                    class="w-full px-4 py-3 bg-input border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:ring-2 focus:ring-ring focus:border-ring resize-none"
                    placeholder="Any other relevant information to support your case..."></textarea>
            </div>

            <!-- Submit Button -->
            <div class="flex items-center justify-between pt-4 border-t border-border">
                <p class="text-sm text-muted-foreground">
                    <i class="ph ph-warning text-yellow-500"></i>
                    Once submitted, evidence cannot be modified.
                </p>
                <button type="submit" class="px-6 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors">
                    Submit Evidence
                </button>
            </div>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
