{#
  Responsive Picture Macro

  Generates <picture> elements with AVIF, WebP, and JPEG srcsets for responsive images.
  Uses content-based hashing for immutable CDN caching.

  Parameters:
    - path: Original image path, e.g., "/static/images/original/lifestyle/DSC_1068.jpg"
    - alt: Alt text for accessibility (required)
    - sizes: Responsive sizes attribute, e.g., "(max-width: 768px) 100vw, 50vw"
    - class: Optional CSS classes for the <img> element
    - picture_class: Optional CSS classes for the <picture> wrapper element
    - loading: "lazy" (default) or "eager" for above-fold images

  Usage:
    {% import "macros/picture.html" as img %}
    {{ img::picture(path="/static/images/original/lifestyle/DSC_1068.jpg", alt="Lifestyle photo", sizes="100vw") }}
    {{ img::picture(path="/static/images/original/hero/hero-self-love.png", alt="Hero", sizes="100vw", class="w-full", loading="eager") }}

  Output filenames use content hashes for cache busting:
    /static/images/derived/lifestyle/DSC_1068.a1b2c3d4-320.avif
#}

{% macro picture(path, alt, sizes, class="", picture_class="", loading="lazy") %}
{# Extract the base path: remove /static/images/original/ prefix and file extension #}
{% let base = path.trim_start_matches("/static/images/original/").trim_end_matches(".jpg").trim_end_matches(".jpeg").trim_end_matches(".png").trim_end_matches(".JPG").trim_end_matches(".JPEG").trim_end_matches(".PNG") %}
{# Get the content hash, default size, and base URL for this image #}
{% let hash = base|image_hash %}
{% let default_size = base|image_default_size %}
{% let img_base_url = ""|image_base_url %}
<picture{% if !picture_class.is_empty() %} class="{{ picture_class }}"{% endif %}>
  <source type="image/avif"
    srcset="{{ base|image_srcset(hash, "avif") }}"
    sizes="{{ sizes }}">
  <source type="image/webp"
    srcset="{{ base|image_srcset(hash, "webp") }}"
    sizes="{{ sizes }}">
  <img
    src="{{ img_base_url }}/{{ base }}.{{ hash }}-{{ default_size }}.jpg"
    srcset="{{ base|image_srcset(hash, "jpg") }}"
    sizes="{{ sizes }}"
    {% if !class.is_empty() %}class="{{ class }}"{% endif %}
    loading="{{ loading }}"
    decoding="async"
    alt="{{ alt }}">
</picture>
{% endmacro %}

{#
  SVG Image Macro

  For SVG images that don't need responsive variants - served from derived directory.
  Uses content-based hashing for immutable CDN caching.

  Parameters:
    - path: Original SVG path, e.g., "/static/images/original/branding/Logo_MarkOnly.svg"
    - alt: Alt text for accessibility
    - class: Optional CSS classes
#}
{% macro svg(path, alt, class="") %}
{# Extract base path and get hash #}
{% let base = path.trim_start_matches("/static/images/original/").trim_end_matches(".svg") %}
{% let hash = base|image_hash %}
{% let img_base_url = ""|image_base_url %}
<img src="{{ img_base_url }}/{{ base }}.{{ hash }}.svg" alt="{{ alt }}" {% if !class.is_empty() %}class="{{ class }}"{% endif %} decoding="async">
{% endmacro %}
