# Product queries for Shopify Storefront API

# Fragment for money fields
fragment MoneyFields on MoneyV2 {
  amount
  currencyCode
}

# Fragment for image fields
fragment ImageFields on Image {
  id
  url
  altText
  width
  height
}

# Fragment for SEO fields
fragment SeoFields on SEO {
  title
  description
}

# Fragment for Shop Pay Installments pricing
fragment ShopPayInstallmentsFields on ShopPayInstallmentsProductVariantPricing {
  eligible
  pricePerTerm {
    ...MoneyFields
  }
  installmentsCount {
    count
  }
  fullPrice {
    ...MoneyFields
  }
}

# Fragment for product variant fields
fragment ProductVariantFields on ProductVariant {
  id
  title
  availableForSale
  quantityAvailable
  sku
  barcode
  price {
    ...MoneyFields
  }
  compareAtPrice {
    ...MoneyFields
  }
  selectedOptions {
    name
    value
  }
  image {
    ...ImageFields
  }
  shopPayInstallmentsPricing {
    ...ShopPayInstallmentsFields
  }
}

# Fragment for core product fields
fragment ProductFields on Product {
  id
  handle
  title
  description
  descriptionHtml
  availableForSale
  productType
  vendor
  tags
  createdAt
  updatedAt
  onlineStoreUrl
  seo {
    ...SeoFields
  }
  priceRange {
    minVariantPrice {
      ...MoneyFields
    }
    maxVariantPrice {
      ...MoneyFields
    }
  }
  compareAtPriceRange {
    minVariantPrice {
      ...MoneyFields
    }
    maxVariantPrice {
      ...MoneyFields
    }
  }
  featuredImage {
    ...ImageFields
  }
  options {
    id
    name
    optionValues {
      id
      name
    }
  }
}

# Fragment for metafield fields
fragment MetafieldFields on Metafield {
  value
  type
}

# Fragment for selling plan price adjustment
fragment SellingPlanPriceAdjustmentFields on SellingPlanPriceAdjustment {
  adjustmentValue {
    __typename
    ... on SellingPlanPercentagePriceAdjustment {
      adjustmentPercentage
    }
    ... on SellingPlanFixedAmountPriceAdjustment {
      adjustmentAmount {
        ...MoneyFields
      }
    }
    ... on SellingPlanFixedPriceAdjustment {
      price {
        ...MoneyFields
      }
    }
  }
  orderCount
}

# Fragment for selling plan fields
fragment SellingPlanFields on SellingPlan {
  id
  name
  description
  options {
    name
    value
  }
  priceAdjustments {
    ...SellingPlanPriceAdjustmentFields
  }
  recurringDeliveries
}

# Fragment for selling plan group fields
fragment SellingPlanGroupFields on SellingPlanGroup {
  name
  options {
    name
    values
  }
  sellingPlans(first: 10) {
    edges {
      node {
        ...SellingPlanFields
      }
    }
  }
}

# Get a single product by handle
query GetProductByHandle(
  $handle: String!
  $imageCount: Int = 10
  $variantCount: Int = 50
) {
  product(handle: $handle) {
    ...ProductFields
    requiresSellingPlan
    rating: metafield(namespace: "reviews", key: "rating") {
      ...MetafieldFields
    }
    ratingCount: metafield(namespace: "reviews", key: "rating_count") {
      ...MetafieldFields
    }
    ingredients: metafield(namespace: "custom", key: "ingredients") {
      ...MetafieldFields
    }
    directions: metafield(namespace: "custom", key: "directions") {
      ...MetafieldFields
    }
    warning: metafield(namespace: "custom", key: "warning") {
      ...MetafieldFields
    }
    promotes: metafield(namespace: "custom", key: "promotes") {
      ...MetafieldFields
    }
    benefits: metafield(namespace: "custom", key: "benefits") {
      ...MetafieldFields
    }
    freeFrom: metafield(namespace: "custom", key: "free_from") {
      ...MetafieldFields
    }
    images(first: $imageCount) {
      edges {
        node {
          ...ImageFields
        }
      }
    }
    variants(first: $variantCount) {
      edges {
        node {
          ...ProductVariantFields
        }
      }
    }
    sellingPlanGroups(first: 5) {
      edges {
        node {
          ...SellingPlanGroupFields
        }
      }
    }
  }
}

# Get paginated list of products
query GetProducts(
  $first: Int = 20
  $after: String
  $sortKey: ProductSortKeys
  $reverse: Boolean = false
  $query: String
) {
  products(
    first: $first
    after: $after
    sortKey: $sortKey
    reverse: $reverse
    query: $query
  ) {
    edges {
      cursor
      node {
        ...ProductFields
        images(first: 1) {
          edges {
            node {
              ...ImageFields
            }
          }
        }
        variants(first: 1) {
          edges {
            node {
              ...ProductVariantFields
            }
          }
        }
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

# Get product recommendations
query GetProductRecommendations($productId: ID!, $intent: ProductRecommendationIntent) {
  productRecommendations(productId: $productId, intent: $intent) {
    ...ProductFields
    images(first: 1) {
      edges {
        node {
          ...ImageFields
        }
      }
    }
    variants(first: 1) {
      edges {
        node {
          ...ProductVariantFields
        }
      }
    }
  }
}
